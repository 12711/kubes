FROM golang:latest

RUN mkdir -p /build

RUN cd $GOPATH \
	&& mkdir -p src/github.com/coreos/etcd \
	&& cd src/github.com/coreos/etcd \
	&& curl -L https://github.com/coreos/etcd/archive/v@VERSION@.tar.gz | tar xz --strip-components=1 -C .

RUN cd $GOPATH/src/github.com/coreos/etcd \
	&& sed -e 's|GIT_SHA=.*|GIT_SHA=v@VERSION@|' -i build \
	&& ./build

RUN cd $GOPATH/src/github.com/coreos/etcd \
	&& cp bin/etcd /build \
	&& strip /build/etcd
